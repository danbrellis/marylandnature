!function(d){d(document).on("sowsetupformfield",".siteorigin-widget-field-type-autocomplete",function(e){var l=d(this);if(!l.data("initialized")){var o=function(){var e=l.find("input.siteorigin-widget-input").val();return 0===e.length?[]:e.split(",")},i=function(){var n=o();l.find("ul.items > li").each(function(e,t){var i=d(this);-1<n.indexOf(i.data("value"))?i.addClass("selected"):i.removeClass("selected")})},n=function(){var e=l.find(".content-text-search"),t=e.val(),i=e.data("source"),n=e.data("postTypes"),a={action:"so_widgets_search_"+i};"posts"===i?(a.query=t,a.postTypes=n):"terms"===i&&(a.term=t);var s=l.find("ul.items").empty().addClass("loading");return d.get(soWidgets.ajaxurl,a,function(e){e.forEach(function(e){""===e.label&&(e.label="&nbsp;"),s.append(d("<li>").html(e.label+"<span>("+e.type+")</span>").data(e))}),s.removeClass("loading")})};l.find(".siteorigin-widget-autocomplete-input").click(function(){var e=l.find(".existing-content-selector");e.show();var t=new d.Deferred;e.is(":visible")&&0===e.find("ul.items li").length?t=n():t.resolve(),t.done(i)});var t=function(){l.find(".existing-content-selector").hide()};d(window).mousedown(function(e){0===l.find(e.target).length&&t()}),l.find(".button-close").click(t),l.on("click",".items li",function(e){e.preventDefault();var t=d(this),i=o(),n=t.data("value"),a=i.indexOf(n);-1<a?(i.splice(a,1),t.removeClass("selected")):(i.push(n),t.addClass("selected"));var s=l.find("input.siteorigin-widget-input");s.val(i.join(",")),s.change()});var a=null;l.find(".content-text-search").keyup(function(){null!==a&&clearTimeout(a),a=setTimeout(function(){n()},500)}),l.data("initialized",!0)}})}(jQuery);