function sowbAdminGoogleMapInit(){sowbForms.mapsInitializing=!1,sowbForms.mapsInitialized=!0,sowbForms.setupLocationFields()}window.sowbForms=window.sowbForms||{},sowbForms.LocationField=function(){return{init:function(e){if(void 0!==google.maps.places){var i=e.querySelector(".siteorigin-widget-location-input"),n=e.querySelector(".siteorigin-widget-input"),t=new google.maps.places.Autocomplete(i),s=function(o){return new Promise(function(i,t){var n={name:o.name};if(n.address=o.hasOwnProperty("formatted_address")?o.formatted_address:"",o.hasOwnProperty("geometry"))n.location=o.geometry.location.toString(),i(n);else{var e={address:o.hasOwnProperty("formatted_address")?o.formatted_address:o.name};(new google.maps.Geocoder).geocode(e,function(e,o){o===google.maps.GeocoderStatus.OK?(n.location=e[0].geometry.location.toString(),i(n)):t(o)})}})},o=function(){var e=JSON.parse(n.value),o="";e.hasOwnProperty("address")&&(o=e.address),e.hasOwnProperty("name")&&0!==o.indexOf(e.name)&&(o=e.name+", "+o),i.removeEventListener("change",r),i.value=o,i.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),i.addEventListener("change",r)};n.addEventListener("change",o);var a=function(e){n.value=JSON.stringify(e),n.removeEventListener("change",o),n.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),n.addEventListener("change",o)};t.addListener("place_changed",function(){var o=t.getPlace();s(o).then(function(e){a(e)}).catch(function(e){console.warn('SiteOrigin Google Maps Widget: Geocoding failed for "'+o.name+'" with status: '+e)})});var r=function(){a({name:i.value})};if(i.addEventListener("change",r),n.value){var l={};try{var d=JSON.parse(n.value);d.hasOwnProperty("location")||d.hasOwnProperty("address")&&(l.name=d.address)}catch(e){l.name=n.value}if(l.hasOwnProperty("name")&&"null"!==l.name){sowbForms.mapsMigrationLogged||(console.info("SiteOrigin Google Maps Widget: Starting automatic migration of location. Please wait a moment..."),sowbForms.mapsMigrationLogged=!0);var c=100;sowbForms._geocodeQueue.push({place:l,field:n}),1===sowbForms._geocodeQueue.length&&setTimeout(function(){!function i(e,t){s(e).then(function(e){if(t.value=JSON.stringify(e),n.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),sowbForms._geocodeQueue.shift(),0<sowbForms._geocodeQueue.length){var o=sowbForms._geocodeQueue[0];setTimeout(function(){i(o.place,o.field)},c)}else console.info("SiteOrigin Google Maps Widget: Location fields updated. Please save the post to complete the migration.")}).catch(function(e){if(e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT)if(sowbForms.hasOwnProperty("overQueryLimitCount")?sowbForms.overQueryLimitCount++:sowbForms.overQueryLimitCount=1,sowbForms.overQueryLimitCount<3){var o=sowbForms._geocodeQueue[0];c*=10,setTimeout(function(){i(o.place,o.field)},c)}else console.warn("SiteOrigin Google Maps Widget: Automatic migration of old address failed with status: "+e),console.info("SiteOrigin Google Maps Widget: Please save this post and open the form to try again.")})}(l,n)},c)}else o()}}else console.error("SiteOrigin Google Maps Widget: Failed to load the places library.")}}},sowbForms.setupLocationFields=function(){google&&google.maps&&google.maps.places&&document.querySelectorAll(".siteorigin-widget-field-type-location").forEach(function(e){!(0===e.offsetWidth||0===e.offsetHeight)&&"true"!==e.getAttribute("data-initialized")&&((new sowbForms.LocationField).init(e),e.setAttribute("data-initialized","true"))})},window.addEventListener("DOMContentLoaded",function(){var n=n||jQuery;n&&n(document).on("sowsetupformfield",".siteorigin-widget-field-type-location",function(){sowbForms._geocodeQueue=sowbForms._geocodeQueue||[];var i=n(this);if(!i.is(":not(:visible)")&&!sowbForms.mapsInitializing)if(sowbForms.mapsInitialized)sowbForms.setupLocationFields();else{sowbForms.mapsInitializing=!0;var e=i.find(".location-field-data").data("apiKey");if(e||(sowbForms.displayNotice(n(this).closest(".siteorigin-widget-form"),soLocationField.missingApiKey,"",[{label:soLocationField.globalSettingsButtonLabel,url:soLocationField.globalSettingsButtonUrl}],i),console.warn("SiteOrigin Google Maps Widget: Could not find API key. Google Maps API key is required."),e=""),window.console&&window.console.error){var t=window.console.error;sowbForms.checkMapsApiInvalidKeyError=function(e){var o;if("string"==typeof e&&(null===(o=e.match(/^Google Maps.*API (error|warning): (.*)/))&&(o=e.match(/^This API project is not authorized to use this API/)),o&&(3===o.length?o=o[2]:1===o.length&&(o="ApiNotActivatedMapError"))),o)switch(o){case"InvalidKeyMapError":sowbForms.displayNotice(n(this).closest(".siteorigin-widget-form"),soLocationField.invalidApiKey,"",[{label:soLocationField.globalSettingsButtonLabel,url:soLocationField.globalSettingsButtonUrl}],i);break;case"ApiNotActivatedMapError":sowbForms.displayNotice(n(this).closest(".siteorigin-widget-form"),soLocationField.apiNotEnabled,"",[],i)}t.apply(window.console,arguments)}.bind(this),window.console.error=sowbForms.checkMapsApiInvalidKeyError}var o="https://maps.googleapis.com/maps/api/js?key="+e+"&libraries=places&callback=sowbAdminGoogleMapInit";n("body").append('<script async type="text/javascript" src="'+o+'">')}})});